---
title: "[보안] Lenovo y700 4세대 rooting"
date: 2025-09-16 20:56:00 +0900
categories: [Security, Android]
tags: [ai, security]
math: true
---

## Lenovo y700 4세대 rooting

NPU 성능 profiling을 위해 Lenovo y700 4세대(이하 y704)에 대한 rooting을 수행한다. [포럼](https://xdaforums.com/t/lenovo-legion-y700-4th-generation-tb322fc-8g4-unlock-bootloader.4743906/)에 방법이 나와있어서 이걸 참고해서 진행했다.


유선 adb 연결을 해놔야한다.
무선으로 해야겠다. 유선으로 큰 파일 보내니까 중간에 끊긴다..


## 부트로더 언락

y704의 Bootloadr_sn을 추출해야 한다. adb 명령어로 쉽게 출력할 수 있다.

1. method1

    Open the USB debugging and OEM unlocking of the device. (개발자 설정에서 지정할 수 있다.)
    Connect the device to the computer.
    for file transfer or not for data transfer.
    Use the USB interface as shown in the figure. (가로로 놨을 때 아래쪽에 있는거.)
    Use the adb command to enter the following command:

    ```bash
    adb reboot bootloader
    fastboot getvar all
    ```

    Wait for output, then search for bootloader_SN_Part1 and Bootloader_SN_Part2
    Bootloader_SN(64 digits in total) = Bootloader_SN_Part1 + Bootloader_SN_Part2
    example：
    Bootloader sN Part1: d2a746c23a410256b1f4a94a299880f8
    BootloaderSN Part2：f34a8bbc2dbc6d298d4d322e093a997c
    Bootloader SN=Bootloader SN Part1+ Bootloader SN Part2 = d2a746c23a410256b1f4a94a299880f8f34a8bbc2dbc6d298d4d322e093a997c
    We need to remember the 64 bit Bootloader_SN of our device carefully

2. method2

    Open the USB debugging and OEM unlocking of the device. (개발자 설정에서 지정할 수 있다.)
    Connect the device to the computer.
    Use the adb command to enter the following command:

    ```bash
    adb shell getprop ro.boot.bootload_sn
    ```

    This command will output Bootloader_SN (Bootloader SN Part1+Bootloader SN Part2)
    We need to remember the 64 digit Bootloader_SN

이후.. flashing과 부트로더 언락을 수행한다.

포럼의 파일 다운로드 후 hex editior로 열어서 5가 64개인 부분을 찾아 기기의 Bootloader_SN으로 수정해 저장한다.
Then use hexadecimal to open the sn (1). img file I sent, and modify the 64 5s inside to match your device's Bootloader_SN(Bootloader_SN_Part1 + Bootloader_SN_Part2 )
Then save.

이후 adb로 기기에 전송한다.
Use the adb command to execute the following instruction:


우선 bootloader로 진입해야 한다.

```base
adb reboot bootloader
```

fastboot란..
https://coding-by-head.tistory.com/entry/adb-fastboot
fastboot devices로 연결을 확인한다.. adb와 동일하게 왜인지 powershell에서는 안 뜨고... wsl로 attach했더니 보인다.

```bash
fastboot flash unlock sn.img
```

이때 짧은 변 쪽이 아니라 긴 변 쪽 포트에 케이블을 연결해야 뜬다...

flashing이 됐으면 unlock한다.
After successfully flashing the unlocked partition, continue using the adb command,
아래의 명령어를 실행하고 y704를 볼륨버튼으로 조작해 언락할 수 있다.
Press the volume down button twice to (unlock the booloader )and press the power button
At this point, your device has been unlocked and all data on the device will be cleared.

```bash
fastboot oem unlock
```

부트로더 언락은 됐다.
왜인지 모르겠는데 부트로더 언락을 하니까 powershell에서 adb에 보인다..? 이제 powershell로 하자.


이제 Qualcomm 9008 tool를 사용하고, 포럼에서 제공하는 y700 (8g4) 9008.melf 파일을 사용해 기기의 init_boot.img를 추출해야 한다. 
9008 tool은 PC에 설치해서 EDL 모드로 열린 y704을 인식할 수 있도록 하는 driver인 듯하다.
이 부분만 잘 해결되면 ok일 것 같다.

이후 Magisk를 사용해 추출한 img 파일을 patch?하고, y704로 다시 전송하면 된다.
magisk는 안드로이드 루팅 및 루팅 상태 관리를 위한 어플리케이션이다.
https://github.com/topjohnwu/Magisk
apk 파일 다운받아서 y704에 설치했다. init_boot.img만 있으면 된다.

9008...
https://qdloader9008.com/qualcomm-qdloader-9008-driver-v1-00-25
9008 driver는 EDL 모드에서 퀄컴 디바이스와 컴퓨터의 연결을 지원한다고 한다.
이 driver 자체는 USB 연결을 기반으로 하는 것 같다. 즉 유선으로 해야 된다..
포트가 잘 뜨는 것을 확인했다.


근데 init_boot.img. 이 parition?을 어떻게 추출하는지 모르겠다.
QFIL이라는 것을 사용할 수 있다고 한다.
https://qfiltool.com/qfil-tool-v2-0-3-5
programemr file을 쓰는데.. 여기에 melf 파일을 쓰는 거 같다.

Qualcomm usb driver 설치해야 된다고 한다
https://qcomdriver.com/qualcomm-usb-driver-v1-0-10065-1

일단 QFIL로 해보자.. 아마도 부트로더 언락을 안해도 추출은 되지 않을까.


QFIL을 보니 partition manager가 있다. 근데 아마 EDL 모드여야 될 거 같다.
아래 명령어로 edl 모드로 열었다.
EDL 모드에 진입하면 화면이 꺼져 있어 겉보기에는 전원이 꺼진 것처럼 보이지만, PC의 장치 관리자에서는 Qualcomm HS-USB QDLoader 9008이라는 포트로 인식됩니다.

```bash
adb reboot edl
```

이후 QFIL에서 port를 인식된 9008?로 지정해줬다. 그랬더니 tools에 partition manager가 보인다. 눌렀더니 flat build에서 programmer path?를 지정하라고 한다.
포럼에서 제공한 파일을 지정하면.. 내부적으로 작업을 수행해 init_boot.img를 추출하는건가..? 근데 안된다.

연결이 불안정해서 그런건가? 뒤쪽 USB 포트에 연결해봤다.
후면에 있는 걸 써도 그렇다..
gemini에 의하면 USB 3.0을 써서 그렇다는 거 같다? USB 2.0이 안정적이라고 한다.

뭐 이런 글도 있다..
https://m.ppomppu.co.kr/new/bbs_view.php?id=androidtab&no=182110

그럴 거 같긴 했는데.. bootload 언락을 해도 여전히 안된다.





---

If you need root，Using the Qualcomm 9008 tool.
( y700 (8g4) 9008.melf)this is the 9008 boot file for the fourth generation of the Chinese version Y700. I'm not sure if the global version is universal. Use it to extract your device's (init_boot.img)
Then use Magisk to patch the extracted init_boot.img
For example, the patched file name is: Magick_aoxh-29001.img
After repairing Magick_aoxh-29001.img File transfer to computer.
Open USB debugging on the device,Connect the computer.As shown in the figure

for file transfer or not for data transfer
Use the adb command to enter the following command:

```bash
adb devices (Check if the device is successfully connected)
adb reboot bootloader (Restart the device to fastboot)
fastboot devices (Check if there is a device connected under fastboot)
fastboot flash init_boot_a Magick_aoxh-29001.img (Write (Magick_aoxh-29001.img) to init_oot partition) -> fastboot로 partition 이름 찍어보니 init_boot_a로 되어 있어서 _a를 추가해줬다.
fastboot reboot (Fastboot mode restarts to the system)
```

After starting the device, check if your Magisk is running properly and check if the root is working properly

Finally, you successfully unlocked the device and rooted it!!!




댓글을 보면..
relock하면 벽돌된다고 한다.
Zuxos.. ROM.. 펌웨어인 거 같은데, 이거 버전이 다르면 안되나? 1.1.11.076으로 됐다고 하고, 1.1.11.120은 하면 문제가 생긴다고 한다. 무슨 해결 방법들을 막 써놨는데..
내껀 ZUXOS 1.1.10.051인데... 이걸로 될까?
y704에 업데이트하라고 뜬 거 보면 1.1.11.120로 업데이트하려고 한다. 하면 안될듯...

혹시 모르니 경로에 (), 공백 등을 제거해줬다. 그래도 안된다.

https://www.youtube.com/watch?v=4b1gPktsUtU
해당 기기의 ROM 관련 파일들이 있어야 할 거 같긴 하다. xml 파일..?
QFIL이 그냥 이미 있는 ROM에서 추출하는건가.. 아님 하드웨어에서 직접 읽어오는건가..?

sahara fail. 아마도 USB 연결 문제인 거 같다.
USB 2.0이 아니면 sahara fail이 뜰 거 같기도 하다..
https://blog.naver.com/galvadia/222493252747


포럼을 보니 Lenovo quick fix tablet brush tool을 사용해 ROM을 다운받으라고 하는데, Lenovo Rescue and Smart Assistant를 말하는 것 같다. 근데 이걸론 안된다.
QFIL 아래쪽을 보니.. ROM을 설치하는 링크가 걍 있었다;;;
https://firmwarefile.com/?s=qpst
https://firmwarefile.com/lenovo-y700-gen-4-tb322fc
이건 stock firmware package라고 한다. 순정 펌웨어.



그리고 확인해 보니 y704는 storgae type이 UFS라고 한다. eMMC 대신 UFS로 지정해줬다.

몰랐는데 포럼에 보니까.. rooting을 위한 파일들을 올려놓은 사이트가 있었다. 중국 꺼긴 한데.. 뭐 다운받았다.
https://www.123865.com/s/ArPqVv-9pGsh
1.1.10.051에 대한 init_boot.img도 있었다!
댓글도 잘 읽자...

다운받았더니 init_boot_a.img와 init_boot_b.img가 있다?

<!-- 내 기기의 init_boot.img를 인터넷에서 다운받았는데, init_boot_a.img, init_boot_b.img 이렇게 2개가 있어. 어떻게 된 걸까?

네, init_boot_a.img와 init_boot_b.img 두 개가 있는 것은 지극히 정상이며, 사용자의 기기가 A/B 파티션 시스템을 사용하고 있다는 명확한 증거입니다.

이는 안드로이드 7.0 (누가)부터 도입된 **원활한 시스템 업데이트(Seamless System Updates)**를 위한 방식으로, 최신 기기에서는 표준처럼 사용됩니다.

## A/B 파티션 시스템이란? 💡
A/B 파티션 시스템은 말 그대로 시스템의 핵심 파티션들(boot, init_boot, system 등)이 A와 B, 두 벌씩 존재하는 구조를 말합니다.

한쪽은 사용 중 (Active Slot): 사용자가 현재 사용하고 있는 활성화된 파티션입니다. (예: A 파티션)

다른 한쪽은 대기 중 (Inactive Slot): 다음 업데이트를 위해 대기하는 비활성화된 파티션입니다. (예: B 파티션)

업데이트 과정:

사용자가 A 슬롯으로 기기를 사용하는 동안, 안드로이드는 백그라운드에서 조용히 B 슬롯에 업데이트를 설치합니다.

설치가 완료되면 사용자에게 재부팅을 요청합니다.

사용자가 재부팅하면, 부트로더는 이제 B 슬롯으로 부팅합니다.

사용자는 업데이트가 완료된 새로운 시스템(B 슬롯)을 바로 사용하게 되며, 기존의 A 슬롯은 다음 업데이트를 위한 대기 슬롯이 됩니다.

이 방식 덕분에 업데이트 중 오류가 발생해도 기존에 사용하던 슬롯으로 다시 부팅하면 되므로 '벽돌'이 될 위험이 거의 없고, 업데이트로 인한 사용 불능 시간을 재부팅 시간으로 크게 단축시킬 수 있습니다.

## 루팅 관점에서의 의미와 방법 ⚙️
두 개의 파일이 있기 때문에, 루팅 작업을 하려면 현재 내 기기가 어떤 슬롯(A인지 B인지)을 사용하고 있는지 먼저 확인해야 합니다.

1. 현재 활성화된 슬롯 확인하기
PC와 기기를 연결하고, 상황에 맞는 명령어를 터미널에 입력하여 현재 슬롯을 확인합니다.

기기가 켜진 상태일 때 (ADB 명령어):

Bash

adb shell getprop ro.boot.slot_suffix
기기가 Fastboot 모드일 때:

Bash

fastboot getvar current-slot
명령어를 실행하면 결과로 _a 또는 _b 가 출력됩니다.

2. 올바른 파일 패치 및 플래싱
패치할 파일 선택: 위에서 확인한 활성 슬롯에 맞는 init_boot 이미지를 Magisk로 패치해야 합니다.

결과가 _a 라면 → init_boot_a.img 를 패치합니다.

결과가 _b 라면 → init_boot_b.img 를 패치합니다.

패치된 이미지 플래싱: Fastboot 모드에서 패치된 이미지(magisk_patched.img)를 현재 활성화된 슬롯의 파티션에 정확히 플래싱해야 합니다.

현재 슬롯이 _a 라면:

Bash

fastboot flash init_boot_a magisk_patched.img
현재 슬롯이 _b 라면:

Bash

fastboot flash init_boot_b magisk_patched.img
이처럼 현재 시스템이 구동 중인 파티션을 정확히 타겟팅해야 루팅이 정상적으로 적용됩니다. -->

2개가 있는 게 당연한 거였다.
확인해보니 내 기기는 a였다. a로 하자.
adb push로 기기에 올렸다. magisk로 patching?을 해보자.

patch 파일 생성하고 fastboot로 flash했다.

```bash
PS C:\Users\aica1> fastboot flash init_boot_a C:\Users\aica1\Downloads\1.1.10.051\magisk_patched-29000_OZW5N.img
Sending 'init_boot_a' (8192 KB)                    OKAY [  0.207s]
Writing 'init_boot_a'                              OKAY [  0.005s]
Finished. Total time: 0.239s
PS C:\Users\aica1> fastboot reboot
Rebooting                                          OKAY [  0.000s]
Finished. Total time: 0.002s
...
1|TB322FC:/ $ su
Permission denied
13|TB322FC:/ $
```

?? 왜 루팅이 안됐지 magisk가 잘 깔린 거 같긴 한데..
superuser에서 shell을 체크해주니 루팅이 됐다!!!! su root도 먹힌다!!




